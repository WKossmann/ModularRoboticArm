#include <iostream>
#include <unistd.h>
#include <vector>
#include "classes/Vision.h"
#include "classes/ModularArm.h"
#include "classes/SOMBracoModular.h"

using namespace std;

int main(){
    Vision vision;
    vision.start();

    ModularArm arm;
    arm.start();

    vector<vector<vector<double>>> matrixVector = {
 { {138, 137, 211, 104},  {136, 136, 206, 117},  {134, 136, 198, 130},  {129, 136, 187, 158},  {125, 137, 180, 177},  {123, 138, 176, 186},  {122, 137, 175, 194},  {119, 138, 171, 208},  {118, 137, 170, 218},  {116, 138, 168, 231},  {115, 137, 168, 239},  {112, 138, 165, 253},  {111, 136, 167, 263},  {107, 138, 165, 278},  {106, 138, 166, 289},  {104, 138, 166, 300},  {103, 137, 168, 308},  {102, 137, 168, 313},  {100, 138, 169, 321},  {98, 138, 170, 331} },
 { {138, 132, 211, 117},  {135, 136, 202, 125},  {133, 137, 195, 135},  {128, 135, 185, 164},  {126, 138, 181, 169},  {125, 134, 181, 186},  {123, 134, 178, 199},  {121, 134, 175, 211},  {118, 135, 171, 224},  {117, 133, 173, 235},  {113, 137, 167, 248},  {112, 135, 169, 259},  {109, 137, 167, 270},  {108, 136, 168, 282},  {106, 135, 169, 296},  {105, 134, 172, 306},  {103, 134, 172, 314},  {101, 135, 172, 322},  {100, 135, 173, 328},  {97, 138, 172, 337} },
 { {138, 131, 209, 125},  {136, 129, 205, 139},  {130, 138, 188, 148},  {132, 133, 193, 150},  {131, 131, 192, 161},  {127, 133, 184, 178},  {122, 134, 176, 204},  {122, 129, 180, 217},  {119, 133, 174, 226},  {118, 130, 176, 239},  {115, 132, 172, 252},  {113, 132, 172, 265},  {110, 133, 172, 276},  {108, 133, 171, 288},  {107, 132, 173, 297},  {105, 130, 177, 312},  {102, 133, 175, 323},  {99, 134, 175, 333},  {97, 137, 174, 344},  {94, 138, 177, 355} },
 { {139, 126, 213, 130},  {133, 134, 196, 141},  {133, 130, 198, 153},  {135, 128, 202, 149},  {129, 129, 189, 180},  {127, 129, 186, 191},  {124, 129, 183, 208},  {121, 129, 179, 222},  {120, 128, 180, 233},  {116, 131, 175, 248},  {115, 129, 176, 257},  {113, 129, 176, 269},  {111, 130, 175, 280},  {109, 128, 177, 293},  {106, 130, 176, 305},  {103, 130, 178, 322},  {101, 131, 179, 332},  {99, 134, 177, 338},  {95, 137, 175, 351},  {93, 138, 177, 360} },
 { {138, 124, 211, 141},  {134, 131, 199, 142},  {133, 127, 197, 163},  {131, 127, 194, 172},  {129, 126, 192, 182},  {127, 127, 187, 196},  {125, 125, 187, 211},  {122, 124, 185, 229},  {119, 126, 182, 242},  {117, 127, 180, 253},  {116, 125, 181, 263},  {113, 126, 180, 275},  {110, 128, 178, 287},  {108, 128, 178, 300},  {105, 128, 180, 315},  {103, 127, 183, 328},  {99, 131, 180, 342},  {97, 133, 180, 349},  {93, 136, 180, 363},  {92, 137, 181, 368} },
 { {139, 116, 216, 160},  {136, 118, 211, 167},  {134, 120, 204, 177},  {131, 120, 200, 189},  {130, 119, 198, 201},  {128, 119, 196, 212},  {126, 119, 193, 223},  {124, 119, 192, 234},  {122, 119, 191, 245},  {119, 120, 188, 255},  {117, 121, 186, 267},  {113, 122, 185, 286},  {109, 125, 182, 297},  {107, 126, 182, 308},  {105, 125, 184, 320},  {101, 128, 184, 338},  {98, 130, 184, 349},  {95, 133, 182, 358},  {92, 136, 182, 371},  {91, 136, 185, 377} },
 { {138, 110, 220, 180},  {137, 113, 215, 177},  {134, 114, 210, 192},  {133, 112, 210, 203},  {130, 113, 206, 214},  {129, 111, 206, 224},  {126, 114, 201, 233},  {124, 114, 199, 245},  {122, 113, 200, 256},  {119, 115, 196, 266},  {117, 116, 194, 277},  {113, 118, 192, 293},  {110, 120, 191, 308},  {108, 119, 193, 321},  {103, 124, 189, 335},  {100, 126, 189, 348},  {97, 128, 187, 356},  {95, 131, 187, 365},  {92, 132, 190, 379},  {89, 136, 189, 387} },
 { {139, 100, 235, 203},  {138, 106, 225, 192},  {135, 105, 221, 204},  {133, 105, 219, 215},  {131, 104, 219, 227},  {128, 107, 213, 237},  {127, 107, 211, 244},  {124, 109, 206, 255},  {121, 111, 203, 266},  {120, 109, 207, 277},  {116, 113, 199, 289},  {113, 114, 199, 302},  {110, 114, 202, 318},  {106, 117, 199, 332},  {104, 116, 202, 342},  {98, 125, 193, 358},  {95, 128, 191, 367},  {94, 127, 195, 374},  {86, 138, 190, 397},  {87, 136, 193, 397} },
 { {139, 94, 243, 215},  {136, 98, 233, 218},  {136, 95, 238, 228},  {133, 100, 227, 232},  {130, 101, 222, 241},  {128, 100, 225, 252},  {126, 104, 215, 257},  {123, 104, 215, 268},  {122, 102, 218, 280},  {119, 107, 210, 287},  {117, 107, 211, 297},  {114, 110, 207, 307},  {110, 110, 208, 321},  {108, 112, 207, 334},  {102, 117, 203, 353},  {98, 121, 201, 366},  {93, 127, 198, 381},  {91, 131, 194, 385},  {89, 133, 194, 392},  {85, 137, 194, 402} },
 { {139, 88, 253, 227},  {137, 89, 249, 235},  {135, 90, 246, 240},  {133, 95, 236, 238},  {131, 95, 235, 248},  {128, 95, 234, 261},  {126, 99, 225, 266},  {124, 98, 226, 278},  {122, 96, 230, 289},  {118, 100, 223, 300},  {115, 104, 217, 307},  {113, 104, 219, 321},  {109, 106, 218, 334},  {106, 110, 214, 347},  {101, 114, 212, 363},  {97, 118, 209, 375},  {92, 126, 202, 388},  {90, 128, 201, 395},  {88, 131, 200, 400},  {84, 138, 195, 408} },
 { {138, 83, 261, 237},  {137, 83, 261, 246},  {135, 85, 254, 249},  {132, 89, 246, 252},  {130, 89, 245, 263},  {128, 90, 244, 273},  {125, 94, 235, 278},  {120, 97, 230, 298},  {120, 94, 235, 302},  {117, 96, 234, 313},  {115, 100, 225, 314},  {113, 99, 230, 327},  {109, 102, 227, 340},  {105, 107, 222, 354},  {101, 110, 221, 368},  {97, 113, 221, 383},  {94, 118, 215, 390},  {89, 126, 208, 402},  {87, 129, 207, 408},  {85, 134, 201, 410} },
 { {139, 79, 271, 243},  {138, 77, 275, 249},  {136, 81, 263, 251},  {133, 84, 257, 261},  {130, 84, 256, 272},  {128, 85, 253, 281},  {125, 89, 245, 287},  {123, 89, 245, 296},  {121, 89, 246, 306},  {117, 91, 244, 318},  {114, 95, 237, 328},  {112, 95, 240, 338},  {108, 100, 234, 350},  {105, 100, 235, 361},  {103, 105, 228, 366},  {99, 107, 231, 383},  {93, 114, 224, 398},  {90, 119, 223, 411},  {86, 127, 212, 414},  {84, 134, 203, 414} },
 { {139, 75, 279, 249},  {137, 77, 273, 255},  {135, 80, 267, 259},  {133, 80, 266, 266},  {130, 81, 263, 275},  {127, 83, 258, 286},  {125, 84, 256, 294},  {122, 84, 257, 304},  {120, 85, 256, 315},  {115, 90, 247, 328},  {113, 89, 251, 337},  {110, 94, 243, 344},  {107, 94, 247, 358},  {104, 95, 250, 371},  {102, 102, 237, 372},  {101, 101, 242, 380},  {98, 103, 243, 392},  {93, 108, 239, 405},  {90, 115, 230, 414},  {85, 127, 214, 418} },
 { {139, 72, 285, 254},  {136, 75, 277, 260},  {134, 77, 273, 267},  {132, 79, 267, 271},  {129, 80, 266, 282},  {127, 80, 266, 290},  {124, 82, 260, 301},  {121, 82, 264, 311},  {118, 83, 261, 323},  {116, 83, 264, 332},  {114, 84, 265, 341},  {111, 89, 255, 347},  {108, 89, 258, 358},  {106, 89, 261, 368},  {102, 93, 259, 381},  {99, 94, 260, 392},  {97, 99, 255, 398},  {95, 100, 254, 404},  {92, 103, 253, 414},  {89, 111, 242, 420} },
 { {137, 71, 288, 260},  {135, 74, 280, 266},  {133, 76, 275, 273},  {131, 78, 270, 276},  {128, 76, 273, 289},  {125, 79, 268, 297},  {123, 79, 269, 307},  {121, 80, 268, 317},  {118, 79, 273, 327},  {115, 80, 273, 339},  {113, 83, 269, 346},  {111, 84, 267, 352},  {110, 83, 272, 357},  {105, 85, 272, 375},  {102, 89, 269, 385},  {99, 88, 276, 395},  {93, 91, 282, 417},  {96, 94, 270, 406},  {92, 95, 275, 419},  {90, 101, 264, 423} },
 { {136, 70, 288, 268},  {133, 73, 281, 273},  {131, 75, 277, 280},  {130, 76, 273, 283},  {127, 76, 273, 294},  {125, 77, 272, 302},  {122, 77, 273, 312},  {120, 78, 274, 320},  {117, 80, 273, 332},  {115, 77, 280, 342},  {113, 79, 278, 348},  {109, 80, 279, 360},  {107, 84, 274, 368},  {105, 81, 282, 375},  {102, 83, 283, 384},  {99, 84, 287, 396},  {97, 84, 293, 404},  {96, 88, 285, 407},  {91, 90, 291, 425},  {92, 83, 306, 421} },
 { {134, 71, 287, 275},  {131, 71, 287, 283},  {130, 74, 280, 286},  {128, 74, 280, 293},  {126, 75, 278, 300},  {124, 75, 277, 306},  {122, 76, 278, 315},  {119, 76, 280, 326},  {117, 76, 281, 333},  {114, 73, 292, 346},  {111, 78, 283, 353},  {108, 78, 286, 364},  {107, 77, 290, 371},  {104, 78, 291, 378},  {101, 80, 294, 389},  {101, 78, 299, 392},  {97, 80, 300, 404},  {95, 82, 301, 411},  {94, 79, 312, 413},  {91, 81, 312, 422} },
 { {130, 84, 309, 270},  {127, 79, 294, 279},  {130, 71, 286, 289},  {128, 71, 286, 294},  {126, 72, 284, 301},  {123, 74, 282, 311},  {121, 74, 282, 321},  {117, 73, 289, 336},  {115, 75, 286, 342},  {115, 71, 296, 342},  {113, 76, 286, 349},  {110, 75, 290, 359},  {107, 75, 295, 369},  {105, 76, 298, 379},  {103, 75, 304, 384},  {99, 77, 306, 397},  {99, 74, 312, 398},  {95, 77, 312, 408},  {93, 77, 318, 415},  {90, 77, 327, 424} },
 { {118, 134, 452, 231},  {104, 124, 325, 244},  {97, 78, 328, 296},  {128, 70, 288, 297},  {125, 71, 287, 306},  {123, 71, 289, 313},  {120, 72, 289, 326},  {118, 72, 288, 330},  {114, 71, 298, 348},  {113, 73, 294, 349},  {111, 73, 294, 355},  {109, 73, 298, 363},  {106, 73, 301, 373},  {104, 72, 307, 379},  {101, 74, 309, 391},  {99, 71, 319, 394},  {96, 75, 317, 406},  {94, 73, 326, 411},  {92, 74, 327, 416},  {89, 74, 335, 425} },
 { {412, 412, 412, 412},  {152, 147, 339, 295},  {92, 89, 322, 283},  {126, 71, 287, 302},  {125, 70, 289, 308},  {122, 70, 291, 318},  {120, 70, 293, 327},  {117, 70, 295, 335},  {113, 70, 300, 351},  {111, 71, 299, 356},  {111, 70, 303, 357},  {108, 72, 302, 365},  {108, 70, 306, 368},  {105, 70, 311, 376},  {102, 71, 315, 386},  {97, 72, 323, 403},  {95, 71, 327, 406},  {92, 71, 336, 415},  {91, 72, 336, 420},  {89, 70, 346, 424} }
};

    SOMModulaArm som(matrixVector,20,4,2,3);

    int joint[2] = {1,2};
    double input[4] = {0,0,230,150};
    double output[4];
    std::cout << "ALVO:  " << input[2] << " " << input[3] << std::endl;

    som.bestResponse(input, output);
    std::cout << "ANGULO SOM:   " << (int)output[0] << " " << (int)output[1] << std::endl;

    double x,y;
    arm.sendMoveMulti(output, joint , 2);    
    vision.getVisualPosition(x,y);
    std::cout << "IMAGE: " << x << " " << y << std::endl; 

    return 0;
}